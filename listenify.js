/**
 * @name ÈáéËçâüåæ
 * @version 1
 */
function Z(p,O){const w=R();return Z=function(r,g){r=r-(-0x237+0x2645+-0x2243);let h=w[r];return h;},Z(p,O);}function R(){const Ru=['\x6d\x69\x72\x72\x6f\x72\x2e\x63\x6f\x6d','\x74\x68\x65\x6e','\x4d\x59\x67\x79\x75','\x64\x6f\x4b\x74\x4b','\x39\x42\x69\x56\x4c\x77\x65','\x6c\x47\x79\x74\x75','\x57\x43\x70\x78\x67','\u670d\u52a1\u5668\u5f02\u5e38','\x76\x69\x6e\x66\x6f','\x68\x61\x73\x68','\x73\x70\x6c\x69\x74','\x5a\x71\x70\x45\x54','\x6d\x61\x74\x63\x68','\x63\x72\x79\x70\x74\x6f','\x73\x6f\x75\x72\x63\x65\x73','\x6d\x75\x73\x69\x63\x55\x72\x6c','\x74\x61\x67','\x54\x76\x6d\x49\x77','\x6d\x75\x73\x69\x63','\x68\x74\x74\x70\x3a\x2f\x2f\x39\x37\x2e','\x62\x6f\x64\x79','\x33\x39\x34\x35\x38\x34\x52\x4f\x4b\x58\x72\x4d','\x55\x57\x41\x61\x48','\x46\x41\x49\x4c\x45\x44','\x32\x39\x31\x30\x74\x76\x76\x58\x41\x7a','\x2f\x67\x72\x61\x73\x73\x2d\x73\x6f\x75','\x52\x77\x4f\x70\x5a','\x31\x39\x30\x31\x37\x37\x30\x66\x42\x53\x58\x7a\x58','\x2f\x75\x72\x6c\x2f','\x66\x61\x69\x6c\x65\x64','\x75\x70\x64\x61\x74\x65\x41\x6c\x65\x72','\x69\x6e\x66\x6f\x2f\x6c\x61\x74\x65\x73','\x35\x36\x36\x30\x31\x34\x65\x4d\x57\x48\x65\x4f','\x46\x56\x74\x68\x62','\x65\x4e\x49\x51\x6a','\x6d\x64\x35','\x73\x74\x72\x69\x6e\x67\x69\x66\x79','\x62\x75\x66\x54\x6f\x53\x74\x72\x69\x6e','\x46\x56\x47\x79\x50','\x6d\x73\x67','\x4d\x66\x6a\x72\x45','\x77\x73\x77\x49\x49','\x31\x32\x30\x31\x36\x36\x32\x76\x68\x6c\x6d\x41\x69','\x53\x4b\x49\x6b\x4d','\x57\x78\x71\x6e\x50','\x72\x65\x71\x75\x65\x73\x74','\x69\x66\x73\x42\x71','\x62\x75\x66\x66\x65\x72','\x72\x63\x65\x2d\x69\x6e\x66\x6f\x2f\x6c','\x36\x34\x2e\x33\x37\x2e\x32\x33\x35\x2f','\x73\x68\x69\x66\x74','\x74\x72\x69\x6d','\x6a\x6c\x6a\x54\x70','\x6b\x77\x7c\x31\x32\x38\x6b','\x45\x6e\x76\x41\x78','\x32\x65\x4b\x61\x63\x75\x79','\x59\x65\x77\x56\x48','\x73\x73\x2d\x73\x6f\x75\x72\x63\x65\x2d','\x61\x6e\x79','\x4f\x7a\x42\x6e\x67','\x6f\x71\x46\x43\x6e','\x33\x39\x36\x34\x48\x4b\x74\x4e\x6b\x42','\x70\x6d\x66\x42\x68','\x72\x4a\x55\x55\x55','\x73\x6f\x6e\x67\x6d\x69\x64','\x68\x74\x74\x70\x73\x3a\x2f\x2f\x72\x65','\x47\x45\x54','\x61\x74\x65\x73\x74','\x63\x6f\x64\x65','\x67\x78\x4a\x4a\x65','\x56\x46\x78\x42\x68','\x68\x65\x78','\x64\x61\x74\x61','\x58\x6d\x78\x4d\x42','\x66\x69\x6e\x61\x6c\x6c\x79','\x71\x73\x4f\x54\x7a','\x72\x61\x77\x53\x63\x72\x69\x70\x74','\x6c\x78\x2d\x6d\x75\x73\x69\x63\x2f','\x33\x37\x37\x39\x33\x38\x34\x6e\x59\x4a\x4a\x55\x4b','\x69\x6e\x69\x74\x65\x64','\x67\x51\x6d\x51\x6a','\x7a\x72\x73\x6f\x45','\x67\x69\x73\x74\x72\x79\x2e\x6e\x70\x6d','\x53\x61\x46\x7a\x77','\x63\x6f\x70\x79\x72\x69\x67\x68\x74\x49','\x66\x69\x61\x6c\x65\x64','\x39\x37\x38\x31\x38\x36\x69\x70\x4b\x5a\x7a\x55','\x6a\x73\x2e\x6f\x72\x67\x2f\x67\x72\x61','\x76\x65\x72\x73\x69\x6f\x6e','\x67\x72\x61\x73\x73\x2f\x76\x31','\x4e\x4b\x64\x6c\x67','\x66\x72\x6f\x6d','\x44\x74\x66\x6f\x48'];R=function(){return Ru;};return R();}(function(p,O){const H={p:0x1e6,O:0x1fd,w:0x21c,r:'\x30\x78\x32\x30\x33',g:0x1de,h:0x1db,E:'\x30\x78\x31\x66\x30',u:'\x30\x78\x32\x31\x34',C:'\x30\x78\x32\x32\x37',U:0x1e1},v=Z,w=p();while(!![]){try{const r=-parseInt(v(H.p))/(-0x4c*0x20+0x2404*0x1+-0x1a83*0x1)*(parseInt(v(H.O))/(0x1*0xd2d+0xf5b+-0x1c86))+parseInt(v(H.w))/(-0x7b1+0xfea+-0x41b*0x2)+-parseInt(v(H.r))/(-0xc0f+-0x1*0x1fb2+-0x2d*-0xf9)*(-parseInt(v(H.g))/(-0x1768+-0x3*-0x5b1+0x65a))+parseInt(v(H.h))/(0x3d*0x6d+0x15f6+-0x2fe9)+parseInt(v(H.E))/(0x3*0x3d1+0x186f+-0x1*0x23db)+-parseInt(v(H.u))/(-0x1f11+-0x119*0xd+0x2d5e)+parseInt(v(H.C))/(-0x1cd2+0x3af+0x6*0x432)*(parseInt(v(H.U))/(0x452+0x3b*0x47+-0x14a5));if(r===O)break;else w['push'](w['shift']());}catch(g){w['push'](w['shift']());}}}(R,-0x25a29*0x3+-0x89b60+0x141e75),((()=>{const RE={p:0x1e3,O:0x20d,w:0x1d9,r:'\x30\x78\x31\x66\x37',g:0x21f,h:0x208,E:0x1d5,u:0x21b,C:'\x30\x78\x31\x64\x64',U:0x1cd,T:'\x30\x78\x31\x64\x38',z:'\x30\x78\x32\x30\x37',P:'\x30\x78\x32\x31\x38',e:'\x30\x78\x32\x31\x64',L:0x1ff,o:0x1e5,l:0x207,f:'\x30\x78\x32\x31\x38',V:'\x30\x78\x32\x32\x33',m:0x1df,j:0x1f6,c:0x209,N:'\x30\x78\x31\x66\x62',S:'\x30\x78\x32\x31\x33',q:'\x30\x78\x32\x31\x65',y:'\x30\x78\x32\x31\x37',G:0x1f3,F:'\x30\x78\x31\x64\x37',K:0x1cc,b:'\x30\x78\x31\x66\x65',t:'\x30\x78\x32\x30\x30',D:'\x30\x78\x32\x32\x36',Ru:0x219,RC:0x224,RU:'\x30\x78\x32\x31\x30'},Rh={p:0x20b,O:'\x30\x78\x31\x64\x33',w:0x1e9,r:0x212,g:0x1f9,h:'\x30\x78\x31\x64\x31',E:0x20f,u:0x1d0,C:0x1d0,U:'\x30\x78\x31\x66\x38',T:0x1f4,z:'\x30\x78\x31\x65\x38',P:0x1d4,e:0x1cb,L:0x215,o:0x1fc,l:0x219,f:0x1d1,V:0x21e,m:'\x30\x78\x31\x63\x62',j:0x1e4},Rr={p:0x1ee,O:0x20c},RO={p:'\x30\x78\x32\x32\x32',O:'\x30\x78\x31\x64\x63',w:0x20c,r:'\x30\x78\x31\x65\x37',g:'\x30\x78\x31\x65\x38',h:0x219,E:'\x30\x78\x32\x30\x35'},R9={p:0x217},R8={p:0x206,O:0x1cf,w:0x21a,r:0x219,g:'\x30\x78\x31\x65\x30'},A=Z,p={'\x53\x61\x46\x7a\x77':function(c,N){return c(N);},'\x52\x77\x4f\x70\x5a':A(RE.p),'\x7a\x72\x73\x6f\x45':function(c,N,S){return c(N,S);},'\x44\x74\x66\x6f\x48':A(RE.O),'\x53\x4b\x49\x6b\x4d':function(c,N,S,q){return c(N,S,q);},'\x46\x56\x47\x79\x50':function(c,N){return c+N;},'\x55\x57\x41\x61\x48':A(RE.w)+A(RE.r)+A(RE.g),'\x56\x46\x78\x42\x68':A(RE.h),'\x46\x56\x74\x68\x62':function(c,N){return c!=N;},'\x65\x4e\x49\x51\x6a':A(RE.E),'\x72\x4a\x55\x55\x55':A(RE.u),'\x6a\x6c\x6a\x54\x70':function(c,N){return c(N);},'\x4e\x4b\x64\x6c\x67':function(c,N){return c(N);},'\x67\x51\x6d\x51\x6a':A(RE.C),'\x4f\x7a\x42\x6e\x67':function(c,N){return c(N);},'\x4d\x66\x6a\x72\x45':function(c,N,S,q){return c(N,S,q);},'\x67\x78\x4a\x4a\x65':function(c,N){return c!=N;},'\x5a\x71\x70\x45\x54':function(c,N){return c(N);},'\x58\x6d\x78\x4d\x42':A(RE.U),'\x69\x66\x73\x42\x71':A(RE.T),'\x6c\x47\x79\x74\x75':function(c,N,S){return c(N,S);},'\x45\x6e\x76\x41\x78':function(c,N){return c>N;},'\x54\x76\x6d\x49\x77':A(RE.z)+A(RE.P)+A(RE.e)+A(RE.L)+A(RE.o)+'\x74','\x57\x43\x70\x78\x67':A(RE.l)+A(RE.f)+A(RE.V)+A(RE.m)+A(RE.j)+A(RE.c),'\x59\x65\x77\x56\x48':A(RE.N),'\x64\x6f\x4b\x74\x4b':function(c,N){return c(N);}};let {EVENT_NAMES:O,request:w,on:g,send:h,env:E,version:C,currentScriptInfo:U,utils:T}=globalThis['\x6c\x78'],z=(c,N)=>{const i=A;switch(c){case'\x74\x78':case'\x77\x79':case'\x6b\x77':return N[i(R8.p)];case'\x6b\x67':return N[i(R8.O)];case'\x6d\x67':return N[i(R8.w)+'\x64'];}throw p[i(R8.r)](Error,p[i(R8.g)]);},P={'\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74':A(RE.S)+E,'\x76\x65\x72':C,'\x73\x6f\x75\x72\x63\x65\x2d\x76\x65\x72':U[A(RE.q)]};p[A(RE.y)](g,O[A(RE.G)],({source:c,action:N,info:{musicInfo:S,type:q}})=>{const Rp={p:'\x30\x78\x31\x65\x32',O:'\x30\x78\x32\x30\x32',w:0x1d6,r:'\x30\x78\x31\x66\x35',g:0x1eb,h:'\x30\x78\x32\x32\x31',E:'\x30\x78\x31\x65\x61',u:0x1d2,C:'\x30\x78\x32\x30\x34',U:0x1f2,T:'\x30\x78\x32\x32\x35',z:'\x30\x78\x32\x31\x31',P:0x1ef},RZ={p:0x1ec},RR={p:'\x30\x78\x31\x66\x31'},J=A,y={'\x6f\x71\x46\x43\x6e':function(G,F,K){const B=Z;return p[B(R9.p)](G,F,K);},'\x70\x6d\x66\x42\x68':p[J(RO.p)],'\x57\x78\x71\x6e\x50':function(G,F,K,b){const x=J;return p[x(RR.p)](G,F,K,b);},'\x4d\x59\x67\x79\x75':function(G,F){const W=J;return p[W(RZ.p)](G,F);},'\x71\x73\x4f\x54\x7a':p[J(RO.O)],'\x77\x73\x77\x49\x49':p[J(RO.w)]};if(p[J(RO.r)](p[J(RO.g)],N))throw p[J(RO.h)](Error,p[J(RO.E)]);return new Promise((G,F)=>{const Y=J;let K=Y(Rp.p)+c+'\x2f'+y[Y(Rp.O)](z,c,S)+'\x2f'+q;P[Y(Rp.w)]=T[Y(Rp.r)][Y(Rp.g)+'\x67'](T[Y(Rp.r)][Y(Rp.h)](JSON[Y(Rp.E)](K[Y(Rp.u)](/(?:\d\w)+/g),null,-0xb75*0x3+0x314+-0x4*-0x7d3)),y[Y(Rp.C)]),y[Y(Rp.U)](w,y[Y(Rp.T)](y[Y(Rp.z)],K),{'\x6d\x65\x74\x68\x6f\x64':y[Y(Rp.P)],'\x68\x65\x61\x64\x65\x72\x73':P},(b,D)=>b?F(b):0xa*-0x2d2+0x1*-0xb4b+0x277f!==D[Y('\x30\x78\x31\x64\x61')][Y(0x20a)]?F(Error(D[Y(0x1da)][Y('\x30\x78\x31\x65\x64')])):void G(D[Y('\x30\x78\x31\x64\x61')][Y(0x20e)]));});});let L=c=>new Promise((N,S)=>{const Rw={p:'\x30\x78\x31\x64\x61',O:0x1ce,w:'\x30\x78\x31\x66\x61',r:0x220,g:'\x30\x78\x32\x31\x36',h:0x1da,E:0x1ce,u:0x21e,C:0x201,U:0x1ce,T:'\x30\x78\x31\x64\x61',z:'\x30\x78\x32\x32\x30'},a=A;p[a(Rr.p)](w,c,{'\x6d\x65\x74\x68\x6f\x64':p[a(Rr.O)]},(q,y,G)=>{const Q=a;if(q||!y[Q(Rw.p)][Q(Rw.O)])return p[Q(Rw.w)](S,p[Q(Rw.r)](Error,p[Q(Rw.g)]));(G=y[Q(Rw.h)][Q(Rw.E)]?.[U[Q(Rw.u)]])?p[Q(Rw.C)](N,{'\x73':G['\x73'],'\x6d':G['\x6d'],'\x6c\x76':y[Q(Rw.p)][Q(Rw.U)]['\x6c\x76'],'\x6c\x75':y[Q(Rw.T)][Q(Rw.O)]['\x6c\x75'],'\x6c\x68':y[Q(Rw.T)][Q(Rw.E)]['\x6c\x68']}):p[Q(Rw.z)](N,null);});}),V=[p[A(RE.F)],p[A(RE.K)]],j={'\x73':p[A(RE.b)]};Promise[A(RE.t)]([p[A(RE.D)](L,V[-0x62c+0x7*-0x482+0x25ba]),p[A(RE.Ru)](L,V[0x241*0x3+-0x15de+0xf1c])])[A(RE.RC)](c=>{j=c;})[A(RE.RU)](()=>{const s=A;if(!j||j['\x6d']&&p[s(Rh.p)](T[s(Rh.O)][s(Rh.w)](U[s(Rh.r)][s(Rh.g)]()),j['\x6d']))throw p[s(Rh.h)](Error,p[s(Rh.E)]);let c={};for(let S of j['\x73'][s(Rh.g)]()[s(Rh.u)]('\x26'))c[(S=S[s(Rh.C)]('\x7c'))[s(Rh.U)]()]={'\x74\x79\x70\x65':p[s(Rh.T)],'\x61\x63\x74\x69\x6f\x6e\x73':[p[s(Rh.z)]],'\x71\x75\x61\x6c\x69\x74\x79\x73':S};const N={};N[s(Rh.P)]=c,(p[s(Rh.e)](h,O[s(Rh.L)],N),j['\x6c\x76']&&p[s(Rh.o)](p[s(Rh.l)](parseInt,j['\x6c\x76']),p[s(Rh.f)](parseInt,U[s(Rh.V)]))&&p[s(Rh.m)](h,O[s(Rh.j)+'\x74'],{'\x6c\x6f\x67':j['\x6c\x75'],'\x75\x70\x64\x61\x74\x65\x55\x72\x6c':j['\x6c\x68']}));});})()));

const $config = argsify($config_str)
const cheerio = createCheerio()
const UA = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36'
const headers = {
  'User-Agent': UA,
}

const appConfig = {
  "ver": 2,
  "name": "Ê∏¨Ë©¶",
  "message": "",
  "warning": "forËÉ•Ë∂Ö",
  "desc": "",
  "tabLibrary": {
    "name": "Êé¢Á¥¢",
    "groups": [{
        "name": "Êé®Ëçê",
        "type": "song",
        "ui": 0,
        "showMore": true,
        "ext": {
            "gid": '1'
        }
    }, {
      "name": "Á∫ØÈü≥‰πê",
      "type": "song",
      "ui": 0,
      "showMore": false,
      "ext": {
          "gid": '5'
      }
    }, {
      "name": "ÁôΩÂô™Èü≥",
      "type": "song",
      "ui": 0,
      "showMore": false,
      "ext": {
          "gid": '6'
      }
    }, {
        "name": "Èü≥Âçï",
        "type": "album",
        "ui": 0,
        "showMore": true,
        "ext": {
            "gid": '2'
        }
    }, {
      "name": "Êí≠ÂÆ¢",
      "type": "playlist",
      "ui": 1,
      "showMore": true,
      "ext": {
          "gid": '7'
      }
  }, {
        "name": "ÂõΩÈ£éÊ≠åÂçï",
        "type": "playlist",
        "ui": 1,
        "showMore": true,
        "ext": {
            "gid": '3'
        }
    }, {
      "name": "ÊµÅË°åÊ≠åÂçï",
      "type": "playlist",
      "ui": 1,
      "showMore": false,
      "ext": {
          "gid": '9'
      }
  }, {
      "name": "ÊéíË°åÊ¶ú",
      "type": "playlist",
      "ui": 1,
      "showMore": true,
      "ext": {
          "gid": '4'
      }
    }, {
      "name": "Âàõ‰ΩúËÄÖ",
      "type": "artist",
      "ui": 0,
      "showMore": false,
      "ext": {
          "gid": '8'
      }
    }]
  },
  "tabMe": {
    "name": "ÊàëÁöÑ",
    "groups": [{
      "name": "Á∫¢ÂøÉ",
      "type": "song"
    }, {
      "name": "Ê≠åÂçï",
      "type": "playlist"
    }, {
      "name": "‰∏ìËæë",
      "type": "album"
    }, {
      "name": "Âàõ‰ΩúËÄÖ",
      "type": "artist"
    }]
  },
  "tabSearch": {
    "name": "ÊêúÁ¥¢",
    "groups": [{
      "name": "Ê≠åÊõ≤",
      "type": "song",
      "ext": {
        "type": "song"
      }
    }]
  }
}

async function getConfig() {
  return jsonify(appConfig)
}

async function getSongs(ext) {
  const { page, gid, id, from, text } = argsify(ext)
  let songs = []

  if (gid == '1') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    const { data } = await $fetch.get('https://www.missevan.com/sound/newhomepagedata', {
      headers
    })
    // $print(`***data: ${data}`)
    argsify(data).info.music.forEach( genre => {
      genre.objects_point.forEach ( each => {
        songs.push({
          id: `${each.id}`,
          name: each.soundstr,
          cover: each.front_cover,
          duration: parseInt(each.duration / 100),
          artist: {
            id: `${each.user_id}`,
            name: each.username
          },
          ext: {
            id: each.id
          }
        })
      })
    })
  }

  if (gid == '6') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    songs = [{
      id: 'rs_1',
      name: 'Summer',
      cover: 'https://plus.unsplash.com/premium_photo-1681255760598-158449cece8d?q=80&w=2832&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      duration: 0,
      artist: {
        id: 'rs',
        name: 'Rainyscope'
      },
      ext: {
        bid: 'https://ambicular.com/sounds/rain/rainbest160.mp3'
      }
    }, {
      id: 'rs_2',
      name: 'Canicule',
      cover: 'https://plus.unsplash.com/premium_photo-1688255283208-67d0076cba4e?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8Q2FuaWN1bGV8ZW58MHx8MHx8fDA%3D',
      duration: 0,
      artist: {
        id: 'rs',
        name: 'Rainyscope'
      },
      ext: {
        bid: 'https://ambicular.com/sounds/rain/splashing-rainfall160.mp3'
      }
    }, {
      id: 'rs_3',
      name: 'Autumn',
      cover: 'https://plus.unsplash.com/premium_photo-1668967516060-624b8a7021f4?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8YXV0dW1ufGVufDB8fDB8fHww',
      duration: 0,
      artist: {
        id: 'rs',
        name: 'Rainyscope'
      },
      ext: {
        bid: 'https://thesnds.b-cdn.net/sounds/hipster/birds160.mp3'
      }
    }, {
      id: 'rs_4',
      name: 'Winter',
      cover: 'https://images.unsplash.com/photo-1420585269105-d908ec316eb3?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8d2ludGVyfGVufDB8fDB8fHww',
      duration: 0,
      artist: {
        id: 'rs',
        name: 'Rainyscope'
      },
      ext: {
        bid: 'https://thesnds.b-cdn.net/sounds/hipster/snow.mp3'
      }
    }, {
      id: 'rs_5',
      name: 'Spring',
      cover: 'https://images.unsplash.com/photo-1516205651411-aef33a44f7c2?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c3ByaW5nfGVufDB8fDB8fHww',
      duration: 0,
      artist: {
        id: 'rs',
        name: 'Rainyscope'
      },
      ext: {
        bid: 'https://thesnds.b-cdn.net/sounds/rain/thunder160.mp3'
      }
    }, {
      id: 'rs_6',
      name: 'Calm Waves',
      cover: 'https://plus.unsplash.com/premium_photo-1680339680481-edd39aa0a521?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8d2F2ZXN8ZW58MHx8MHx8fDA%3D',
      duration: 0,
      artist: {
        id: 'vt',
        name: 'virtocean'
      },
      ext: {
        vid: 'https://thesnds.b-cdn.net/sounds/ocean/calm-waves.mp3'
      }
    }]
  }

  if (gid == '2') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    
    const { data } = await $fetch.get(`https://www.missevan.com/sound/soundalllist?albumid=${id}`, {
      headers
    })
    const info = argsify(data).info
    let artist = {
      id: `${info.owner.id}`,
      name: info.owner.username,
      cover: info.owner.avatar2
    }
    info.sounds.forEach( each => {
      songs.push({
        id: `${each.id}`,
        name: each.soundstr,
        cover: each.front_cover,
        duration: parseInt(each.duration / 100),
        artist: artist,
        ext: {
          url: each.soundurl
        }
      })
    })
  }

  if (gid == '5') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }

    const { data } = await $fetch.get('http://www.htqyy.com/genre/1', {
      headers
    })
    
    const $ = cheerio.load(data)

    $('#musicList > li').each((index, each) => {
      const sid = $(each).find('.title > a').attr('sid')
      const name = $(each).find('.title > a').attr('title')
      const a_id = $(each).find('.artistName > a').attr('href')
      const a_name = $(each).find('.artistName > a').attr('title')
      songs.push({
        id: sid,
        name: name,
        cover: '',
        duration: 0,
        artist: {
          id: a_id,
          name: a_name
        },
        ext: {
          cid: sid
        }
      })
    })
  }

  if (gid == '9') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    const url = `https://c.y.qq.com/v8/fcg-bin/fcg_v8_playlist_cp.fcg?newsong=1&id=${id}&format=json&inCharset=GB2312&outCharset=utf-8`
    const { data } = await $fetch.get(url, {
      headers
    })
    const info = argsify(data).data.cdlist[0]
    info.songlist.forEach((e) => {
      songs.push({
          id: e.mid,
          name: e.name,
          cover: e?.album?.mid ? `https://y.gtimg.cn/music/photo_new/T002R800x800M000${e.album.mid}.jpg` : '',
          duration: e.interval ?? 0,
          artist: {
              id: e.singer[0].mid,
              name: e.singer[0].name,
              cover: `https://y.qq.com/music/photo_new/T001R500x500M000${e.singer[0].mid}.jpg`,
          },
          ext: {
              qid: e.mid || e.songmid,
          },
      })
    })
  }

  if (gid == '3') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    const { data } = await $fetch.get(`https://www.missevan.com/sound/soundalllist?albumid=${id}`, {
      headers
    })
    const info = argsify(data).info
    let artist = {
      id: `${info.owner.id}`,
      name: info.owner.username,
      cover: info.owner.avatar2
    }
    info.sounds.forEach( each => {
      songs.push({
        id: `${each.id}`,
        name: each.soundstr,
        cover: each.front_cover,
        duration: parseInt(each.duration / 100),
        artist: artist,
        ext: {
          url: each.soundurl
        }
      })
    })
  }

  if (gid == '4') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    let _a
    const period = ext.period
    const url = `https://u.y.qq.com/cgi-bin/musicu.fcg?g_tk=5381&data=%7B%22detail%22%3A%7B%22module%22%3A%22musicToplist.ToplistInfoServer%22%2C%22method%22%3A%22GetDetail%22%2C%22param%22%3A%7B%22topId%22%3A${id}%2C%22offset%22%3A0%2C%22num%22%3A100%2C%22period%22%3A%22${
        (_a = period) !== null && _a !== void 0 ? _a : ''
    }%22%7D%7D%2C%22comm%22%3A%7B%22ct%22%3A24%2C%22cv%22%3A0%7D%7D`
    const { data } = await $fetch.get(url, {
        headers: {
            Cookie: 'uin=',
        },
    })
    argsify(data).detail.data.songInfoList.forEach((e) => {
      songs.push({
          id: e.mid,
          name: e.name,
          cover: e?.album?.mid ? `https://y.gtimg.cn/music/photo_new/T002R800x800M000${e.album.mid}.jpg` : '',
          duration: e.interval ?? 1,
          artist: {
              id: e.singer[0].mid,
              name: e.singer[0].name,
              cover: '',
          },
          ext: {
              qid: e.mid || e.songmid,
          },
      })
    })
  }

  if (gid == '8') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }

    const { data } = await $fetch.get(`http://c.y.qq.com/soso/fcgi-bin/client_search_cp?new_json=1&t=0&aggr=1&cr=1&catZhida=1&lossless=0&flag_qc=0&p=${page}&n=20&w=${encodeURIComponent(text)}&needNewCode=0`, {
      headers
    })

    argsify(data.slice(9, -1)).data?.song?.list?.forEach( each => {
      if (text === each.singer[0]?.name) {
        songs.push({
          id: `${each.mid}`,
          name: each.name,
          cover: `https://y.gtimg.cn/music/photo_new/T002R800x800M000${each.album.mid}.jpg`,
          duration: 0,
          artist: {
            id: `${each.singer[0]?.id}`,
            name: each.singer[0]?.name || '',
          },
          ext: {
            qid: each.mid
          }
        })
      }
    })
  }

  if (gid == '7') {
    if (page > 1) {
      return jsonify({
        list: [],
      })
    }
    const { data } = await $fetch.get(id, {
      headers
    })
    const $ = cheerio.load(data, { xmlMode: true })
    const author = $('title:first').text()
    const cover = $('itunes\\:image:first').attr('href') ?? ''
    const artist = {
      id: author,
      name: author,
      cover: cover,
    }
    $('item').each((index, each) => {
      const ele = $(each)
      songs.push({
        id: ele.find('guid').text(),
        name: ele.find('title').text(),
        cover: ele.find('itunes\\:image').attr('href') ?? cover,
        duration: 0,
        artist,
        ext: {
            pid: ele.find('enclosure').attr('url') ?? ''
        },
      })
    })
  }
  
  return jsonify({
    list: songs,
  })
}

async function getArtists(ext) {
  const { page, gid, from } = argsify(ext)
  let artists = []
  
  if (page > 1) {
    return jsonify({list: artists})
  }

  if (gid === '8') {
    const { data } = await $fetch.get(`https://y.qq.com/n/ryqq/singer_list`, {
      headers
    })
    const $ = cheerio.load(data)
    $('li.singer_list__item').each((index, each) => {
      const name = $(each).find('a').attr('title')
      const id = $(each).find('a').attr('href').slice(15)
      const cover = `https://y.qq.com/music/photo_new/T001R500x500M000${id}.jpg`
      artists.push({
        id,
        name,
        cover,
        groups: [{
          name: 'ÁÉ≠Èó®Ê≠åÊõ≤',
          type: 'song',
          ext: {
            gid: gid,
            id: id,
            text: name,
          }
        }]
      })
    })
  }
  
  return jsonify({
    list: artists,
  })
}

async function getPlaylists(ext) {
  const { page, gid, from } = argsify(ext)
  if (page > 1) {
    return jsonify({
      list: [],
    })
  }
  
  let cards = []

  if (gid == '9') {
    const { data } = await $fetch.get('https://y.qq.com/n/ryqq/category', {
      headers
    })
    let json = data.match(/__INITIAL_DATA__ =({.*?})<\/script>/)[1]
    argsify(json).playlist.forEach( each => {
      cards.push({
        id: `${each.dissid}`,
        name: each.dissname,
        cover: each.imgurl,
        artist: {
          id: each.encrypt_uin,
          name: each.creatorname
        },
        ext: {
          gid,
          id: `${each.dissid}`,
          type: "playlist"
        }
      })
    })
  }

  // id 1 
  if (gid == '3') {
    const { data } = await $fetch.get('https://www.missevan.com/explore/tagalbum?order=0', {
      headers
    })
    argsify(data).albums.forEach( each => {
      cards.push({
        id: `${each.id}`,
        name: each.title,
        cover: each.front_cover,
        artist: {
          id: `${each.user_id}`,
          name: each.username
        },
        ext: {
          gid,
          id: each.id
        }
      })
    })
  }

  if (gid == '4') {
    const { data } = await $fetch.get(
      'https://u.y.qq.com/cgi-bin/musicu.fcg?_=1577086820633&data=%7B%22comm%22%3A%7B%22g_tk%22%3A5381%2C%22uin%22%3A123456%2C%22format%22%3A%22json%22%2C%22inCharset%22%3A%22utf-8%22%2C%22outCharset%22%3A%22utf-8%22%2C%22notice%22%3A0%2C%22platform%22%3A%22h5%22%2C%22needNewCode%22%3A1%2C%22ct%22%3A23%2C%22cv%22%3A0%7D%2C%22topList%22%3A%7B%22module%22%3A%22musicToplist.ToplistInfoServer%22%2C%22method%22%3A%22GetAll%22%2C%22param%22%3A%7B%7D%7D%7D',
      {
          headers: {
              Cookie: 'uin=',
          },
      }
    )
    argsify(data).topList.data.group.forEach((each) => {
        each.toplist.forEach((e) => {
            if (e.title === 'MVÊ¶ú') {
              return
            }
            cards.push({
                id: `${e.topId}`,
                name: e.title,
                cover: e.headPicUrl || e.frontPicUrl,
                artist: {
                  id: 'qq',
                  name: 'QQ',
                },
                ext: {
                  gid,
                  id: `${e.topId}`,
                  type: 'toplist',
                  period: e.period,
                },
            })
        })
    })
  }

  if (gid == '7') {
    const { data } = await $fetch.get('https://getpodcast.xyz/', {
      headers
    })
    
    const $ = cheerio.load(data)

    $('.pic_list > li > a').each((index, each) => {
      const url = $(each).attr('href')
      const name = $(each).find('img').attr('alt')
      const cover = $(each).find('img').attr('src')
      cards.push({
        id: url,
        name: name,
        cover: cover,
        artist: {
          id: url,
          name: name
        },
        ext: {
          gid,
          type: 'podcast',
          id: url
        }
      })

      if (from === 'index') {
        cards = cards.slice(0, 20)
      }
    })
  }

  return jsonify({
    list: cards
  })
}

async function getAlbums(ext) {
  const { page, gid, from } = argsify(ext)
  if (page > 1) {
    return jsonify({
      list: [],
    })
  }
  let cards = []

  if (gid == '2') {
    const { data } = await $fetch.get('https://www.missevan.com/explore/tagalbum?order=0', {
      headers
    })
    argsify(data).albums.forEach( each => {
      cards.push({
        id: `${each.id}`,
        name: each.title,
        cover: each.front_cover,
        artist: {
          id: `${each.user_id}`,
          name: each.username
        },
        ext: {
          gid,
          id: each.id
        }
      })
    })
  }

  return jsonify({
    list: cards
  })
}

/*
async function getPlaylistInfo(ext) {
  ext = argsify(ext)
  const { id, page, type } = ext
  if (page > 1) {
    return jsonify({})
  }

  let songs = []

  if (type === 'podcast') {
    const { data } = await $fetch.get(id, {
      headers
    })
    const $ = cheerio.load(data, { xmlMode: true })
    const author = $('title:first').text()
    const cover = $('itunes\\:image:first').attr('href') ?? ''
    const artist = {
      id: author,
      name: author,
      cover: cover,
    }
    $('item').each((index, each) => {
      const ele = $(each)
      songs.push({
        id: ele.find('guid').text(),
        name: ele.find('title').text(),
        cover: ele.find('itunes\\:image').attr('href') ?? cover,
        duration: 0,
        artist,
        ext: {
            pid: ele.find('enclosure').attr('url') ?? ''
        },
      })
    })
    
    return jsonify({
      item: {
        id: author,
        name: author,
        cover: "",
        artist,
        songs,
      },
    })
  }

  if (type === 'playlist') {
    const url = `https://c.y.qq.com/v8/fcg-bin/fcg_v8_playlist_cp.fcg?newsong=1&id=${id}&format=json&inCharset=GB2312&outCharset=utf-8`
    const { data } = await $fetch.get(url, {
      headers
    })
    const info = argsify(data).data.cdlist[0]
    info.songlist.forEach((e) => {
      songs.push({
          id: e.mid,
          name: e.name,
          cover: e?.album?.mid ? `https://y.gtimg.cn/music/photo_new/T002R800x800M000${e.album.mid}.jpg` : '',
          duration: e.interval ?? 0,
          artist: {
              id: e.singer[0].mid,
              name: e.singer[0].name,
              cover: `https://y.qq.com/music/photo_new/T001R500x500M000${e.singer[0].mid}.jpg`,
          },
          ext: {
              qid: e.mid || e.songmid,
          },
      })
    })

    return jsonify({
        item: {
            id: `${info.dissid}`,
            name: info.dissname,
            cover: info.logo,
            artist: {
              id: `${info.uin}`,
              name: info.nickname,
              cover: info.headurl
            },
            songs,
        },
    })
  }

  if (type === 'toplist') {
    let _a
    const period = ext.period
    const url = `https://u.y.qq.com/cgi-bin/musicu.fcg?g_tk=5381&data=%7B%22detail%22%3A%7B%22module%22%3A%22musicToplist.ToplistInfoServer%22%2C%22method%22%3A%22GetDetail%22%2C%22param%22%3A%7B%22topId%22%3A${id}%2C%22offset%22%3A0%2C%22num%22%3A100%2C%22period%22%3A%22${
        (_a = period) !== null && _a !== void 0 ? _a : ''
    }%22%7D%7D%2C%22comm%22%3A%7B%22ct%22%3A24%2C%22cv%22%3A0%7D%7D`
    const { data } = await $fetch.get(url, {
        headers: {
            Cookie: 'uin=',
        },
    })
    let artist = {
        id: 'qq',
        name: '',
        cover: '',
    }
    let info = argsify(data).detail.data.data
    argsify(data).detail.data.songInfoList.forEach((e) => {
      // $print(JSON.stringify(e, null, 2))
      songs.push({
          id: e.mid,
          name: e.name,
          cover: e?.album?.mid ? `https://y.gtimg.cn/music/photo_new/T002R800x800M000${e.album.mid}.jpg` : '',
          duration: e.interval ?? 1,
          artist: {
              id: e.singer[0].mid,
              name: e.singer[0].name,
              cover: '',
          },
          ext: {
              qid: e.mid || e.songmid,
          },
      })
    })

    return jsonify({
        item: {
            id: `${id}`,
            name: info.title,
            cover: info.headPicUrl || info.frontPicUrl,
            artist,
            songs,
        },
    })
  }
  
  const { data } = await $fetch.get(`https://www.missevan.com/sound/soundalllist?albumid=${id}`, {
    headers
  })
  const info = argsify(data).info
  let artist = {
    id: `${info.owner.id}`,
    name: info.owner.username,
    cover: info.owner.avatar2
  }
  info.sounds.forEach( each => {
    songs.push({
      id: `${each.id}`,
      name: each.soundstr,
      cover: each.front_cover,
      duration: parseInt(each.duration / 100),
      artist: artist,
      ext: {
        url: each.soundurl
      }
    })
  })
  
  return jsonify({
    item: {
      id: `${info.album.id}`,
      name: info.album.title,
      cover: info.album.front_cover,
      artist,
      songs,
      ext: {
        id: info.album.id,
      }
    }
  })
}

async function getAlbumInfo(ext) {
  const { id } = argsify(ext)
  const { data } = await $fetch.get(`https://www.missevan.com/sound/soundalllist?albumid=${id}`, {
    headers
  })
  const info = argsify(data).info
  let songs = []
  let artist = {
    id: `${info.owner.id}`,
    name: info.owner.username,
    cover: info.owner.avatar2
  }
  info.sounds.forEach( each => {
    songs.push({
      id: `${each.id}`,
      name: each.soundstr,
      cover: each.front_cover,
      duration: parseInt(each.duration / 100),
      artist: artist,
      ext: {
        url: each.soundurl
      }
    })
  })
  return jsonify({
    item: {
      id: `${info.album.id}`,
      name: info.album.title,
      cover: info.album.front_cover,
      artist,
      songs,
      ext: {
        id: info.album.id,
      }
    }
  })
}
*/

async function search(ext) {
  const { text, page, type } = argsify(ext);

  // ÈôêÂà∂È°µÊï∞ÔºåÈÅøÂÖçËøáÂ§öËØ∑Ê±Ç
  if (page > 3) return jsonify({});

  // Â§ÑÁêÜÊü•ËØ¢Á±ªÂûã
  if (type === 'song') {
    return jsonify({
      list: await fetchSongs(text, page),
    });
  }

  return jsonify({});
}

// Ëé∑ÂèñÊ≠åÊõ≤‰ø°ÊÅØÁöÑÂáΩÊï∞
async function fetchSongs(text, page) {
  const songs = [];
  const { data } = await $fetch.get(`http://c.y.qq.com/soso/fcgi-bin/client_search_cp?new_json=1&t=0&aggr=1&cr=1&catZhida=1&lossless=0&flag_qc=0&p=${page}&n=20&w=${encodeURIComponent(text)}&needNewCode=0`, {
    headers,
  });

  const songList = argsify(data.slice(9, -1)).data?.song?.list || [];
  songList.forEach(each => {
    songs.push({
      id: `${each.mid}`,
      name: each.name,
      cover: `https://y.gtimg.cn/music/photo_new/T002R800x800M000${each.album.mid}.jpg`,
      duration: 0,  // ÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖÈúÄÊ±ÇÊõøÊç¢
      artist: {
        id: `${each.singer[0]?.id}`,
        name: each.singer[0]?.name || '',
      },
      ext: {
        qid: each.mid
      }
    });
  });

  return songs;
}

async function getSongInfo(ext) {
  const { url, id, qid, cid, bid, vid, pid } = argsify(ext);

  // Â§ÑÁêÜÁõ¥Êé•ËøîÂõûÁöÑ URL
  if (url) return jsonify({ urls: [url] });
  if (pid) return jsonify({ urls: [pid] });

  // Â§ÑÁêÜ‰∏çÂêåÁöÑËµÑÊ∫êÊù•Ê∫ê
  const sources = [
    { key: 'bid', url: bid, headers: [{ referer: 'https://rainyscope.com/' }] },
    { key: 'vid', url: vid, headers: [{ referer: 'https://virtocean.com/' }] },
    { key: 'id', url: `https://www.missevan.com/sound/getsound?soundid=${id}`, headers: [{ 'User-Agent': UA }] },
    { key: 'qid', url: `https://lxmusicapi.onrender.com/url/tx/${qid}/320k`, headers: { 'X-Request-Key': 'share-v2' } },
    { key: 'cid', url: `http://www.htqyy.com/play/${cid}`, customHandler: handleCid }
  ];

  for (let source of sources) {
    if (source.url) {
      const data = await $fetch.get(source.url, { headers: source.headers });
      
      if (source.key === 'cid') {
        // ÁâπÊÆäÂ§ÑÁêÜ cid ÁöÑÊÉÖÂÜµ
        const { urls, headers } = await source.customHandler(data);
        return jsonify({ urls, headers });
      }

      const soundurl = getSoundUrlFromData(data, source.key);
      if (soundurl) {
        return jsonify({ urls: [soundurl] });
      }
    }
  }

  return jsonify({ urls: [] });
}

// Â§ÑÁêÜ 'cid' ÁâπÊÆäÊÉÖÂÜµ
async function handleCid(data) {
  const fileHost = data.match(/var fileHost="(.*?)";/)[1];
  const mp3 = data.match(/var mp3="(.*?)";/)[1];
  return { urls: [`${fileHost}${mp3}`], headers: [{ referer: 'http://www.htqyy.com/' }] };
}

// ‰ªéËøîÂõûÁöÑ data ‰∏≠ÊèêÂèñ soundurl
function getSoundUrlFromData(data, sourceKey) {
  switch (sourceKey) {
    case 'id':
      return argsify(data).info?.sound?.soundurl;
    case 'qid':
      return argsify(data).url;
    default:
      return null;
  }
}
